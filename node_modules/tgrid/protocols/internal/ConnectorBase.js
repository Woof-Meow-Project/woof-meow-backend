"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConnectorBase = void 0;
/**
 * @packageDocumentation
 * @module tgrid.protocols
 */
//----------------------------------------------------------------
var Communicator_1 = require("../../components/Communicator");
var DomainError_1 = require("tstl/exception/DomainError");
var RuntimeError_1 = require("tstl/exception/RuntimeError");
/**
 * Basic Connector.
 *
 * The `ConnectorBase` is an abtract communicator class, who can connect to remote server who
 * interacts with clients using the RFC (Remote Function Call).
 *
 * Also, when declaring this {@link ConnectorBase} type, you've to define two template arguments,
 * *Header* and *Provider*. The *Header* type repersents an initial data gotten from the remote
 * client after the connection. I hope you and client not to omit it and utilize it as an
 * activation tool to enhance security.
 *
 * The second template argument *Provider* represents the features provided for the remote client.
 * If you don't have any plan to provide any feature to the remote client, just declare it as
 * `null`.
 *
 * @template Header Type of the header containing initial data.
 * @template Provider Type of additional features provided for the remote system.
 * @author Jeongho Nam - https://github.com/samchon
 */
var ConnectorBase = /** @class */ (function (_super) {
    __extends(ConnectorBase, _super);
    /* ----------------------------------------------------------------
        CONSTRUCTOR
    ---------------------------------------------------------------- */
    /**
     * Initializer Constructor.
     *
     * @param header An object containing initialization data like activation.
     * @param provider An object providing features for remote system.
     */
    function ConnectorBase(header, provider) {
        var _this = _super.call(this, provider) || this;
        _this.header_ = header;
        _this.state_ = -1 /* ConnectorBase.State.NONE */;
        return _this;
    }
    Object.defineProperty(ConnectorBase.prototype, "header", {
        /* ----------------------------------------------------------------
            ACCESSORS
        ---------------------------------------------------------------- */
        /**
         * Header containing initialization data like activation.
         */
        get: function () {
            return this.header_;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(ConnectorBase.prototype, "state", {
        /**
         * Get state.
         *
         * Get current state of connection state with the worker server.
         *
         * List of values are such like below:
         *
         *   - `NONE`: This instance is newly created, but did nothing yet.
         *   - `CONNECTING`: The `connect` method is on running.
         *   - `OPEN`: The connection is online.
         *   - `CLOSING`: The `close` method is on running.
         *   - `CLOSED`: The connection is offline.
         */
        get: function () {
            return this.state_;
        },
        enumerable: false,
        configurable: true
    });
    /* ----------------------------------------------------------------
        COMMUNICATOR
    ---------------------------------------------------------------- */
    /**
     * @hidden
     */
    ConnectorBase.prototype.inspectReady = function (method) {
        // NO ERROR
        if (this.state_ === 1 /* ConnectorBase.State.OPEN */)
            return null;
        // ERROR, ONE OF THEM
        else if (this.state_ === -1 /* ConnectorBase.State.NONE */)
            return new DomainError_1.DomainError("Error on ".concat(this.constructor.name, ".").concat(method, "(): connect first."));
        else if (this.state_ === 0 /* ConnectorBase.State.CONNECTING */)
            return new DomainError_1.DomainError("Error on ".concat(this.constructor.name, ".").concat(method, "(): it's on connecting, wait for a second."));
        else if (this.state_ === 2 /* ConnectorBase.State.CLOSING */)
            return new RuntimeError_1.RuntimeError("Error on ".concat(this.constructor.name, ".").concat(method, "(): the connection is on closing."));
        else if (this.state_ === 3 /* ConnectorBase.State.CLOSED */)
            return new RuntimeError_1.RuntimeError("Error on ".concat(this.constructor.name, ".").concat(method, "(): the connection has been closed."));
        // UNKNOWN ERROR, IT MAY NOT OCCURED
        else
            return new RuntimeError_1.RuntimeError("Error on ".concat(this.constructor.name, ".").concat(method, "(): unknown error, but not connected."));
    };
    return ConnectorBase;
}(Communicator_1.Communicator));
exports.ConnectorBase = ConnectorBase;
//# sourceMappingURL=ConnectorBase.js.map